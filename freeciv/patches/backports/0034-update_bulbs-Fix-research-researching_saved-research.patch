From d6481dd6a44d7782eacc9df34bc3e935f6528827 Mon Sep 17 00:00:00 2001
From: Marko Lindqvist <cazfi74@gmail.com>
Date: Sun, 14 Apr 2024 01:05:11 +0300
Subject: [PATCH 34/35] update_bulbs(): Fix "research->researching_saved !=
 research->researching" assert

See RM #449

Signed-off-by: Marko Lindqvist <cazfi74@gmail.com>
---
 server/techtools.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/server/techtools.c b/server/techtools.c
index 2144eeeef9..261c18005e 100644
--- a/server/techtools.c
+++ b/server/techtools.c
@@ -662,10 +662,10 @@ void update_bulbs(struct player *pplayer, int bulbs, bool check_tech,
   }
   fc_assert_ret(research);
 
-  /* count our research contribution this turn */
+  /* Count our research contribution this turn */
   pplayer->server.bulbs_last_turn += bulbs;
   research->bulbs_researched += bulbs;
-  if (A_UNKNOWN != research->researching_saved) {
+  if (research->researching_saved != A_UNKNOWN && research->researching_saved != A_UNSET) {
     fc_assert(research->researching_saved != research->researching);
     research->bulbs_researching_saved += bulbs;
   }
-- 
2.43.0

